# CI/CD å®Œæ•´å®æ–½æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªå®Œæ•´çš„ CI/CD æµç¨‹ï¼Œä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½²é¡¹ç›®åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ã€‚

## ğŸ“š ç›®å½•

- [ä»€ä¹ˆæ˜¯ CI/CD](#ä»€ä¹ˆæ˜¯-cicd)
- [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
- [ç¬¬ä¸€é˜¶æ®µï¼šæœåŠ¡å™¨ç¯å¢ƒé…ç½®](#ç¬¬ä¸€é˜¶æ®µæœåŠ¡å™¨ç¯å¢ƒé…ç½®)
- [ç¬¬äºŒé˜¶æ®µï¼šGitHub é…ç½®](#ç¬¬äºŒé˜¶æ®µgithub-é…ç½®)
- [ç¬¬ä¸‰é˜¶æ®µï¼šç¼–å†™éƒ¨ç½²è„šæœ¬](#ç¬¬ä¸‰é˜¶æ®µç¼–å†™éƒ¨ç½²è„šæœ¬)
- [ç¬¬å››é˜¶æ®µï¼šé…ç½® GitHub Actions](#ç¬¬å››é˜¶æ®µé…ç½®-github-actions)
- [ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¸éªŒè¯](#ç¬¬äº”é˜¶æ®µæµ‹è¯•ä¸éªŒè¯)
- [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ä»€ä¹ˆæ˜¯ CI/CD

### CI (Continuous Integration - æŒç»­é›†æˆ)

**ç›®æ ‡**ï¼šé¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°ä¸»åˆ†æ”¯ï¼Œè‡ªåŠ¨è¿›è¡Œæ„å»ºå’Œæµ‹è¯•ï¼ŒåŠæ—©å‘ç°é—®é¢˜ã€‚

**å…¸å‹æµç¨‹**ï¼š

1. å¼€å‘è€…æäº¤ä»£ç åˆ° Git ä»“åº“
2. è‡ªåŠ¨è§¦å‘æ„å»ºæµç¨‹
3. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
4. ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆlintã€æ ¼å¼åŒ–ç­‰ï¼‰
5. æ„å»ºæˆåŠŸ/å¤±è´¥çš„åé¦ˆ

### CD (Continuous Deployment - æŒç»­éƒ¨ç½²)

**ç›®æ ‡**ï¼šå°†é€šè¿‡æµ‹è¯•çš„ä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

**å…¸å‹æµç¨‹**ï¼š

1. CI é˜¶æ®µé€šè¿‡
2. è‡ªåŠ¨æ„å»ºç”Ÿäº§ç‰ˆæœ¬
3. è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
4. å¥åº·æ£€æŸ¥
5. é€šçŸ¥éƒ¨ç½²ç»“æœ

### ä¸ºä»€ä¹ˆéœ€è¦ CI/CDï¼Ÿ

- âš¡ **è‡ªåŠ¨åŒ–**ï¼šå‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œé¿å…äººä¸ºé”™è¯¯
- ğŸ”„ **å¿«é€Ÿè¿­ä»£**ï¼šä»£ç æäº¤åè‡ªåŠ¨éƒ¨ç½²ï¼Œå¿«é€Ÿäº¤ä»˜æ–°åŠŸèƒ½
- ğŸ›¡ï¸ **è´¨é‡ä¿è¯**ï¼šæ¯æ¬¡éƒ¨ç½²å‰éƒ½ç»è¿‡è‡ªåŠ¨åŒ–æµ‹è¯•
- ğŸ“Š **å¯è¿½æº¯**ï¼šæ¯æ¬¡éƒ¨ç½²éƒ½æœ‰è®°å½•ï¼Œä¾¿äºå›æ»š
- ğŸ‘¥ **å›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€çš„éƒ¨ç½²æµç¨‹ï¼Œå‡å°‘ç¯å¢ƒå·®å¼‚

---

## å‰ç½®å‡†å¤‡

### 1. æ£€æŸ¥æ¸…å•

- [ ] é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆ2 æ ¸ 2Gï¼ŒååŒ— 2ï¼‰
  - å…¬ç½‘ IP åœ°å€
  - SSH ç™»å½•è´¦å·å¯†ç 
  - æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼ˆæ¨è Ubuntu 20.04+ï¼‰
- [ ] GitHub ä»“åº“

  - é¡¹ç›®ä»£ç å·²æ¨é€åˆ° GitHub
  - æœ‰ä»“åº“çš„ç®¡ç†æƒé™

- [ ] æœ¬åœ°å¼€å‘ç¯å¢ƒ
  - Git å·²å®‰è£…
  - SSH å·¥å…·ï¼ˆç»ˆç«¯ã€XShell ç­‰ï¼‰

### 2. éœ€è¦è®°å½•çš„ä¿¡æ¯

åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡æ¡£ï¼Œè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼ˆ**æ³¨æ„ï¼šä¸è¦æäº¤åˆ°ä»£ç ä»“åº“**ï¼‰ï¼š

```
æœåŠ¡å™¨ IP: xxx.xxx.xxx.xxx
SSH ç«¯å£: 22
SSH ç”¨æˆ·å: root (æˆ–å…¶ä»–ç”¨æˆ·)
SSH å¯†ç : ********
é¡¹ç›®éƒ¨ç½²è·¯å¾„: /var/www/bondee
```

---

## ç¬¬ä¸€é˜¶æ®µï¼šæœåŠ¡å™¨ç¯å¢ƒé…ç½®

### æ­¥éª¤ 1.1ï¼šè¿æ¥åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨

**ç›®çš„**ï¼šé€šè¿‡ SSH ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œè¿›è¡Œåç»­é…ç½®ã€‚

```bash
# åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œ
ssh root@ä½ çš„æœåŠ¡å™¨IP
# è¾“å…¥å¯†ç åç™»å½•
```

**çŸ¥è¯†ç‚¹**ï¼š

- SSHï¼ˆSecure Shellï¼‰æ˜¯ä¸€ç§åŠ å¯†çš„ç½‘ç»œåè®®ï¼Œç”¨äºå®‰å…¨åœ°è¿œç¨‹ç™»å½•æœåŠ¡å™¨
- `root` æ˜¯ Linux ç³»ç»Ÿçš„è¶…çº§ç®¡ç†å‘˜è´¦æˆ·

### æ­¥éª¤ 1.2ï¼šæ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…

**ç›®çš„**ï¼šç¡®ä¿ç³»ç»Ÿè½¯ä»¶éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…å®‰å…¨æ¼æ´ã€‚

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ…
sudo apt upgrade -y
```

**çŸ¥è¯†ç‚¹**ï¼š

- `apt` æ˜¯ Ubuntu/Debian çš„åŒ…ç®¡ç†å™¨
- `update` æ›´æ–°å¯ç”¨è½¯ä»¶åŒ…åˆ—è¡¨
- `upgrade` å‡çº§å·²å®‰è£…çš„è½¯ä»¶åŒ…
- `-y` è‡ªåŠ¨ç¡®è®¤æ‰€æœ‰æç¤º

### æ­¥éª¤ 1.3ï¼šå®‰è£… Node.js å’Œ pnpm

**ç›®çš„**ï¼šå®‰è£…é¡¹ç›®è¿è¡Œæ‰€éœ€çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚

```bash
# å®‰è£… Node.js 20.xï¼ˆæ¨èä½¿ç”¨ LTS ç‰ˆæœ¬ï¼‰
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node -v   # åº”è¯¥æ˜¾ç¤º v20.x.x
npm -v    # åº”è¯¥æ˜¾ç¤º npm ç‰ˆæœ¬

# å®‰è£… pnpmï¼ˆä½ çš„é¡¹ç›®ä½¿ç”¨ pnpmï¼‰
npm install -g pnpm

# éªŒè¯ pnpm å®‰è£…
pnpm -v
```

**çŸ¥è¯†ç‚¹**ï¼š

- Node.js æ˜¯ JavaScript è¿è¡Œæ—¶ç¯å¢ƒ
- npm æ˜¯ Node.js çš„åŒ…ç®¡ç†å™¨ï¼ˆéš Node.js ä¸€èµ·å®‰è£…ï¼‰
- pnpm æ˜¯æ›´å¿«ã€æ›´èŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å™¨

### æ­¥éª¤ 1.4ï¼šå®‰è£… Nginx

**ç›®çš„**ï¼šNginx ä½œä¸º Web æœåŠ¡å™¨ï¼Œç”¨äºæ‰˜ç®¡ä½ çš„å‰ç«¯é™æ€æ–‡ä»¶ï¼Œå¹¶æä¾›åå‘ä»£ç†åŠŸèƒ½ã€‚

```bash
# å®‰è£… Nginx
sudo apt install nginx -y

# å¯åŠ¨ Nginx
sudo systemctl start nginx

# è®¾ç½® Nginx å¼€æœºè‡ªå¯
sudo systemctl enable nginx

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx
```

æ­¤æ—¶è®¿é—® `http://ä½ çš„æœåŠ¡å™¨IP`ï¼Œåº”è¯¥èƒ½çœ‹åˆ° Nginx çš„æ¬¢è¿é¡µé¢ã€‚

**çŸ¥è¯†ç‚¹**ï¼š

- Nginx æ˜¯é«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨
- `systemctl` æ˜¯ Linux ç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·
- `start` å¯åŠ¨æœåŠ¡ï¼Œ`enable` è®¾ç½®å¼€æœºè‡ªå¯ï¼Œ`status` æŸ¥çœ‹çŠ¶æ€

### æ­¥éª¤ 1.5ï¼šé…ç½®é¡¹ç›®ç›®å½•

**ç›®çš„**ï¼šåˆ›å»ºä¸“é—¨çš„ç›®å½•å­˜æ”¾é¡¹ç›®æ–‡ä»¶ï¼Œç¡®ä¿æƒé™æ­£ç¡®ã€‚

```bash
# åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•
sudo mkdir -p /var/www/bondee

# è®¾ç½®ç›®å½•æƒé™ï¼ˆè®©å½“å‰ç”¨æˆ·å¯ä»¥å†™å…¥ï¼‰
sudo chown -R $USER:$USER /var/www/bondee

# åˆ›å»ºéƒ¨ç½²è„šæœ¬ç›®å½•
mkdir -p /var/www/bondee/scripts
```

**çŸ¥è¯†ç‚¹**ï¼š

- `/var/www` æ˜¯ Linux ä¸­æƒ¯ä¾‹çš„ Web é¡¹ç›®å­˜æ”¾è·¯å¾„
- `mkdir -p` ä¼šåˆ›å»ºå¤šçº§ç›®å½•
- `chown` æ”¹å˜æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰è€…
- `$USER` æ˜¯å½“å‰ç™»å½•ç”¨æˆ·çš„ç¯å¢ƒå˜é‡

### æ­¥éª¤ 1.6ï¼šé…ç½®é˜²ç«å¢™

**ç›®çš„**ï¼šå¼€æ”¾å¿…è¦çš„ç«¯å£ï¼Œç¡®ä¿å¤–éƒ¨å¯ä»¥è®¿é—®ä½ çš„ç½‘ç«™ã€‚

```bash
# å®‰è£… UFWï¼ˆUbuntu é˜²ç«å¢™ï¼‰
sudo apt install ufw -y

# å…è®¸ SSHï¼ˆé‡è¦ï¼å¦åˆ™ä¼šè¢«é”åœ¨å¤–é¢ï¼‰
sudo ufw allow 22/tcp

# å…è®¸ HTTP å’Œ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

**âš ï¸ é‡è¦æç¤º**ï¼š

- å¿…é¡»å…ˆå…è®¸ SSH ç«¯å£ï¼ˆ22ï¼‰ï¼Œå¦åˆ™å¯ç”¨é˜²ç«å¢™åä¼šæ–­å¼€è¿æ¥
- é˜¿é‡Œäº‘è¿˜æœ‰å®‰å…¨ç»„è§„åˆ™ï¼Œéœ€è¦åœ¨æ§åˆ¶å°ä¹Ÿå¼€æ”¾è¿™äº›ç«¯å£

**çŸ¥è¯†ç‚¹**ï¼š

- ç«¯å£ 22ï¼šSSH è¿æ¥
- ç«¯å£ 80ï¼šHTTP è®¿é—®
- ç«¯å£ 443ï¼šHTTPS è®¿é—®

### æ­¥éª¤ 1.7ï¼šé…ç½® SSH å¯†é’¥ç™»å½•

**ç›®çš„**ï¼šä½¿ç”¨å…¬é’¥/ç§é’¥è®¤è¯ä»£æ›¿å¯†ç ç™»å½•ï¼Œæ›´å®‰å…¨ä¸”æ–¹ä¾¿ CI/CD è‡ªåŠ¨åŒ–ã€‚

**åœ¨æœ¬åœ°ç”µè„‘ä¸Š**ï¼š

```bash
# ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼ˆå¦‚æœå·²æœ‰å¯è·³è¿‡ï¼‰
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
# ä¸€è·¯å›è½¦ï¼Œä½¿ç”¨é»˜è®¤è·¯å¾„ ~/.ssh/id_rsa

# å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨
ssh-copy-id root@ä½ çš„æœåŠ¡å™¨IP
# è¾“å…¥å¯†ç ï¼Œå®Œæˆåå°±å¯ä»¥å…å¯†ç™»å½•äº†

# æµ‹è¯•å…å¯†ç™»å½•
ssh root@ä½ çš„æœåŠ¡å™¨IP
# åº”è¯¥ä¸éœ€è¦å¯†ç ç›´æ¥ç™»å½•
```

**å¦‚æœ `ssh-copy-id` ä¸å¯ç”¨**ï¼ˆWindows ç”¨æˆ·ï¼‰ï¼š

```bash
# æŸ¥çœ‹æœ¬åœ°å…¬é’¥
cat ~/.ssh/id_rsa.pub
# å¤åˆ¶è¾“å‡ºçš„å†…å®¹

# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
mkdir -p ~/.ssh
echo "ç²˜è´´åˆšæ‰å¤åˆ¶çš„å…¬é’¥å†…å®¹" >> ~/.ssh/authorized_keys
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

**çŸ¥è¯†ç‚¹**ï¼š

- SSH å¯†é’¥è®¤è¯æ¯”å¯†ç æ›´å®‰å…¨
- ç§é’¥ï¼ˆid_rsaï¼‰ä¿å­˜åœ¨æœ¬åœ°ï¼Œ**åƒä¸‡ä¸è¦æ³„éœ²**
- å…¬é’¥ï¼ˆid_rsa.pubï¼‰å¯ä»¥æ”¾åœ¨æœåŠ¡å™¨ä¸Š
- GitHub Actions å°†ä½¿ç”¨è¿™ä¸ªç§é’¥æ¥è¿æ¥æœåŠ¡å™¨

### æ­¥éª¤ 1.8ï¼šé…ç½® Nginx è™šæ‹Ÿä¸»æœº

**ç›®çš„**ï¼šå‘Šè¯‰ Nginx å¦‚ä½•å¤„ç†ä½ çš„ç½‘ç«™è¯·æ±‚ã€‚

```bash
# åˆ›å»º Nginx é…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/bondee
```

ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„æœåŠ¡å™¨IP;  # æˆ–è€…ä½ çš„åŸŸå

    root /var/www/bondee/dist;
    index index.html;

    # æ”¯æŒå‰ç«¯è·¯ç”±ï¼ˆReact Routerï¼‰
    location / {
        try_files $uri $uri/ /index.html;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

**å¯ç”¨é…ç½®å¹¶é‡å¯ Nginx**ï¼š

```bash
# åˆ›å»ºè½¯é“¾æ¥å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/bondee /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤ç«™ç‚¹ï¼ˆå¯é€‰ï¼‰
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl reload nginx
```

**çŸ¥è¯†ç‚¹**ï¼š

- `server_name`ï¼šæŒ‡å®šåŸŸåæˆ– IP
- `root`ï¼šç½‘ç«™æ–‡ä»¶çš„æ ¹ç›®å½•
- `try_files`ï¼šæ”¯æŒå•é¡µåº”ç”¨ï¼ˆSPAï¼‰çš„å‰ç«¯è·¯ç”±
- `gzip`ï¼šå‹ç¼©å“åº”å†…å®¹ï¼Œå‡å°‘ä¼ è¾“å¤§å°
- `expires`ï¼šè®¾ç½®é™æ€èµ„æºç¼“å­˜æ—¶é—´

---

## ç¬¬äºŒé˜¶æ®µï¼šGitHub é…ç½®

### æ­¥éª¤ 2.1ï¼šé…ç½® GitHub Secrets

**ç›®çš„**ï¼šå°†æ•æ„Ÿä¿¡æ¯ï¼ˆæœåŠ¡å™¨ IPã€SSH ç§é’¥ç­‰ï¼‰å®‰å…¨åœ°å­˜å‚¨åœ¨ GitHubï¼Œä¾› Actions ä½¿ç”¨ã€‚

1. æ‰“å¼€ä½ çš„ GitHub ä»“åº“
2. ç‚¹å‡» **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret**ï¼Œæ·»åŠ ä»¥ä¸‹ secretsï¼š

| Secret åç§°      | å€¼                | è¯´æ˜             |
| ---------------- | ----------------- | ---------------- |
| `SERVER_HOST`    | ä½ çš„æœåŠ¡å™¨ IP     | æœåŠ¡å™¨åœ°å€       |
| `SERVER_USER`    | `root`            | SSH ç™»å½•ç”¨æˆ·å   |
| `SERVER_SSH_KEY` | ç§é’¥å†…å®¹          | ä¸‹é¢è¯´æ˜å¦‚ä½•è·å– |
| `DEPLOY_PATH`    | `/var/www/bondee` | éƒ¨ç½²ç›®å½•         |

**è·å– SSH ç§é’¥**ï¼š

```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
cat ~/.ssh/id_rsa
```

å¤åˆ¶**æ•´ä¸ªå†…å®¹**ï¼ˆåŒ…æ‹¬ `-----BEGIN ... KEY-----` å’Œ `-----END ... KEY-----`ï¼‰ã€‚

**çŸ¥è¯†ç‚¹**ï¼š

- GitHub Secrets æ˜¯åŠ å¯†å­˜å‚¨ï¼Œä¸ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤º
- è¿™æ ·é¿å…äº†åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- åªæœ‰ä»“åº“ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹ Secrets

### æ­¥éª¤ 2.2ï¼šå¯ç”¨ GitHub Actions

**ç›®çš„**ï¼šç¡®ä¿ä»“åº“å¼€å¯äº† Actions åŠŸèƒ½ã€‚

1. è¿›å…¥ä»“åº“ **Settings** â†’ **Actions** â†’ **General**
2. åœ¨ "Actions permissions" ä¸­é€‰æ‹© **Allow all actions and reusable workflows**
3. ç‚¹å‡» **Save**

---

## ç¬¬ä¸‰é˜¶æ®µï¼šç¼–å†™éƒ¨ç½²è„šæœ¬

### æ­¥éª¤ 3.1ï¼šåˆ›å»ºéƒ¨ç½²è„šæœ¬

**ç›®çš„**ï¼šç¼–å†™åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„éƒ¨ç½²è„šæœ¬ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ã€‚

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `scripts/deploy.sh`ï¼š

```bash
#!/bin/bash

# éƒ¨ç½²è„šæœ¬ - åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸš€ å¼€å§‹éƒ¨ç½² Bondee é¡¹ç›®..."

# é…ç½®å˜é‡
DEPLOY_DIR="/var/www/bondee"
BACKUP_DIR="/var/www/bondee_backups"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

# 1. åˆ›å»ºå¤‡ä»½
echo "ğŸ“¦ åˆ›å»ºå½“å‰ç‰ˆæœ¬å¤‡ä»½..."
if [ -d "$DEPLOY_DIR/dist" ]; then
    mkdir -p $BACKUP_DIR
    cp -r $DEPLOY_DIR/dist $BACKUP_DIR/dist_$TIMESTAMP
    echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR/dist_$TIMESTAMP"
fi

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd $DEPLOY_DIR
echo "ğŸ“ å½“å‰ç›®å½•: $(pwd)"

# 3. æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git fetch --all
git reset --hard origin/main  # å¼ºåˆ¶æ›´æ–°åˆ°è¿œç¨‹ main åˆ†æ”¯
echo "âœ… ä»£ç æ›´æ–°å®Œæˆ"

# 4. å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–..."
pnpm install --frozen-lockfile
echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

# 5. æ„å»ºé¡¹ç›®
echo "ğŸ”¨ å¼€å§‹æ„å»ºé¡¹ç›®..."
pnpm run build
echo "âœ… æ„å»ºå®Œæˆ"

# 6. æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘ 5 ä¸ªï¼‰
echo "ğŸ§¹ æ¸…ç†æ—§å¤‡ä»½..."
if [ -d "$BACKUP_DIR" ]; then
    cd $BACKUP_DIR
    ls -t | tail -n +6 | xargs -I {} rm -rf {}
fi

# 7. é‡å¯ Nginx
echo "ğŸ”„ é‡æ–°åŠ è½½ Nginx..."
sudo systemctl reload nginx

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ è®¿é—®åœ°å€: http://$(curl -s ifconfig.me)"
```

**ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™**ï¼š

```bash
chmod +x scripts/deploy.sh
```

**çŸ¥è¯†ç‚¹**ï¼š

- `set -e`ï¼šè„šæœ¬é‡åˆ°ä»»ä½•é”™è¯¯éƒ½ä¼šåœæ­¢æ‰§è¡Œ
- `TIMESTAMP`ï¼šç”Ÿæˆæ—¶é—´æˆ³ç”¨äºå¤‡ä»½
- `git reset --hard`ï¼šå¼ºåˆ¶é‡ç½®åˆ°è¿œç¨‹åˆ†æ”¯ï¼ˆæ…ç”¨ï¼ä¼šä¸¢å¼ƒæœ¬åœ°ä¿®æ”¹ï¼‰
- `--frozen-lockfile`ï¼šç¡®ä¿ä¾èµ–ç‰ˆæœ¬ä¸€è‡´
- å¤‡ä»½æœºåˆ¶ï¼šé˜²æ­¢éƒ¨ç½²å¤±è´¥æ—¶å¯ä»¥å¿«é€Ÿå›æ»š

### æ­¥éª¤ 3.2ï¼šåˆ›å»ºåˆå§‹åŒ–è„šæœ¬

**ç›®çš„**ï¼šç¬¬ä¸€æ¬¡éƒ¨ç½²æ—¶ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå…‹éš†ä»£ç ä»“åº“ã€‚

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `scripts/init-server.sh`ï¼š

```bash
#!/bin/bash

# æœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬ - ä»…é¦–æ¬¡éƒ¨ç½²æ—¶æ‰§è¡Œ

set -e

echo "ğŸ¬ å¼€å§‹åˆå§‹åŒ–æœåŠ¡å™¨..."

DEPLOY_DIR="/var/www/bondee"
REPO_URL="https://github.com/ä½ çš„ç”¨æˆ·å/bondee.git"  # ä¿®æ”¹ä¸ºä½ çš„ä»“åº“åœ°å€

# 1. å…‹éš†ä»£ç ä»“åº“
if [ -d "$DEPLOY_DIR/.git" ]; then
    echo "âš ï¸  é¡¹ç›®å·²å­˜åœ¨ï¼Œè·³è¿‡å…‹éš†"
else
    echo "ğŸ“¥ å…‹éš†ä»£ç åº“..."
    git clone $REPO_URL $DEPLOY_DIR
    echo "âœ… ä»£ç å…‹éš†å®Œæˆ"
fi

# 2. è®¾ç½®ç›®å½•æƒé™
echo "ğŸ” è®¾ç½®ç›®å½•æƒé™..."
sudo chown -R $USER:$USER $DEPLOY_DIR
chmod +x $DEPLOY_DIR/scripts/*.sh

# 3. é…ç½® Gitï¼ˆå¯é€‰ï¼Œé€‚ç”¨äºç§æœ‰ä»“åº“ï¼‰
cd $DEPLOY_DIR
git config core.fileMode false

echo "âœ… æœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆï¼"
echo "ğŸ’¡ ç°åœ¨å¯ä»¥è¿è¡Œ ./scripts/deploy.sh è¿›è¡Œéƒ¨ç½²"
```

**çŸ¥è¯†ç‚¹**ï¼š

- æ­¤è„šæœ¬åªéœ€è¿è¡Œä¸€æ¬¡
- å¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼Œå¯èƒ½éœ€è¦é…ç½® GitHub Personal Access Token

---

## ç¬¬å››é˜¶æ®µï¼šé…ç½® GitHub Actions

### æ­¥éª¤ 4.1ï¼šåˆ›å»º Workflow æ–‡ä»¶

**ç›®çš„**ï¼šå®šä¹‰è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼Œå½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘ã€‚

åˆ›å»º `.github/workflows/deploy.yml`ï¼š

```yaml
name: Deploy to Aliyun

# è§¦å‘æ¡ä»¶
on:
  push:
    branches:
      - main # æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

# ä»»åŠ¡å®šä¹‰
jobs:
  deploy:
    name: éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
    runs-on: ubuntu-latest # åœ¨ GitHub æä¾›çš„ Ubuntu ç¯å¢ƒä¸­è¿è¡Œ

    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç 
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # è·å–å®Œæ•´å†å²è®°å½•

      # æ­¥éª¤ 2: è®¾ç½® Node.js ç¯å¢ƒ
      - name: ğŸŸ¢ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "pnpm" # ä½¿ç”¨ pnpm ç¼“å­˜

      # æ­¥éª¤ 3: å®‰è£… pnpm
      - name: ğŸ“¦ å®‰è£… pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      # æ­¥éª¤ 4: å®‰è£…ä¾èµ–
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pnpm install --frozen-lockfile

      # æ­¥éª¤ 5: è¿è¡Œ Lint æ£€æŸ¥
      - name: ğŸ” ä»£ç è´¨é‡æ£€æŸ¥
        run: pnpm run lint
        continue-on-error: false # Lint å¤±è´¥åˆ™åœæ­¢éƒ¨ç½²

      # æ­¥éª¤ 6: æ„å»ºé¡¹ç›®
      - name: ğŸ”¨ æ„å»ºé¡¹ç›®
        run: pnpm run build
        env:
          NODE_ENV: production

      # æ­¥éª¤ 7: éƒ¨ç½²åˆ°æœåŠ¡å™¨
      - name: ğŸš€ éƒ¨ç½²åˆ°æœåŠ¡å™¨
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          script: |
            # è¿›å…¥é¡¹ç›®ç›®å½•
            cd ${{ secrets.DEPLOY_PATH }}

            # æ‹‰å–æœ€æ–°ä»£ç 
            git pull origin main

            # å®‰è£…ä¾èµ–å¹¶æ„å»º
            pnpm install --frozen-lockfile
            pnpm run build

            # é‡å¯ Nginx
            sudo systemctl reload nginx

            echo "âœ… éƒ¨ç½²æˆåŠŸï¼"

      # æ­¥éª¤ 8: éƒ¨ç½²é€šçŸ¥
      - name: ğŸ“¢ éƒ¨ç½²ç»“æœé€šçŸ¥
        if: always() # æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ
        run: |
          if [ ${{ job.status }} == 'success' ]; then
            echo "âœ… éƒ¨ç½²æˆåŠŸï¼"
          else
            echo "âŒ éƒ¨ç½²å¤±è´¥ï¼"
          fi
```

**çŸ¥è¯†ç‚¹è¯¦è§£**ï¼š

#### Workflow åŸºç¡€

- `name`ï¼šå·¥ä½œæµåç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨ GitHub Actions é¡µé¢
- `on`ï¼šå®šä¹‰è§¦å‘æ¡ä»¶
  - `push`ï¼šä»£ç æ¨é€æ—¶è§¦å‘
  - `workflow_dispatch`ï¼šå…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆåœ¨ Actions é¡µé¢æœ‰æŒ‰é’®ï¼‰

#### Jobs å’Œ Steps

- `jobs`ï¼šä¸€ä¸ª workflow å¯ä»¥åŒ…å«å¤šä¸ª jobï¼Œå¹¶è¡Œæˆ–ä¸²è¡Œæ‰§è¡Œ
- `runs-on`ï¼šæŒ‡å®šè¿è¡Œç¯å¢ƒï¼ˆGitHub æä¾›å…è´¹çš„è™šæ‹Ÿæœºï¼‰
- `steps`ï¼šjob ä¸­çš„å…·ä½“æ­¥éª¤ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œ

#### Actions

- `uses`ï¼šä½¿ç”¨ç¤¾åŒºæä¾›çš„ç°æˆ Action
  - `actions/checkout@v4`ï¼šæ£€å‡ºä»£ç åˆ° runner
  - `actions/setup-node@v4`ï¼šå®‰è£… Node.js
  - `pnpm/action-setup@v2`ï¼šå®‰è£… pnpm
  - `appleboy/ssh-action@master`ï¼šé€šè¿‡ SSH æ‰§è¡Œè¿œç¨‹å‘½ä»¤

#### Secrets

- `${{ secrets.XXX }}`ï¼šå¼•ç”¨åœ¨ GitHub è®¾ç½®çš„ Secrets
- ä¸ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºï¼Œä¿æŠ¤æ•æ„Ÿä¿¡æ¯

#### ç¯å¢ƒå˜é‡

- `env`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡
- `NODE_ENV=production`ï¼šå‘Šè¯‰æ„å»ºå·¥å…·è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒ

### æ­¥éª¤ 4.2ï¼šåˆ›å»ºç®€åŒ–çš„ Workflowï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸Šé¢çš„æ–¹å¼å¤ªå¤æ‚ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„æ–¹å¼â€”â€”ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºï¼š

åˆ›å»º `.github/workflows/deploy-simple.yml`ï¼š

```yaml
name: Simple Deploy

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸš€ æ‰§è¡ŒæœåŠ¡å™¨éƒ¨ç½²è„šæœ¬
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          script: |
            cd ${{ secrets.DEPLOY_PATH }}
            bash scripts/deploy.sh
```

**å¯¹æ¯”ä¸¤ç§æ–¹å¼**ï¼š

| ç‰¹æ€§           | å®Œæ•´ç‰ˆ        | ç®€åŒ–ç‰ˆ                 |
| -------------- | ------------- | ---------------------- |
| æ„å»ºä½ç½®       | GitHub Runner | æœåŠ¡å™¨                 |
| é€Ÿåº¦           | æ›´å¿«ï¼ˆå¹¶è¡Œï¼‰  | è¾ƒæ…¢                   |
| æœåŠ¡å™¨èµ„æºæ¶ˆè€— | ä½            | é«˜ï¼ˆ2 æ ¸ 2G å¯èƒ½åƒåŠ›ï¼‰ |
| å¤±è´¥åé¦ˆ       | æ›´è¯¦ç»†        | è¾ƒç®€å•                 |
| é€‚ç”¨åœºæ™¯       | ç”Ÿäº§ç¯å¢ƒ      | å­¦ä¹ ã€å°é¡¹ç›®           |

**æ¨è**ï¼šå¯¹äº 2 æ ¸ 2G çš„æœåŠ¡å™¨ï¼Œå»ºè®®ä½¿ç”¨**å®Œæ•´ç‰ˆ**ï¼Œåœ¨ GitHub ä¸Šæ„å»ºï¼Œåªä¼ è¾“æ„å»ºç»“æœã€‚

---

## ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¸éªŒè¯

### æ­¥éª¤ 5.1ï¼šé¦–æ¬¡éƒ¨ç½²

**åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆå§‹åŒ–**ï¼š

```bash
# SSH ç™»å½•åˆ°æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
cd /var/www
bash /path/to/your/local/scripts/init-server.sh
```

**æˆ–è€…æ‰‹åŠ¨åˆå§‹åŒ–**ï¼š

```bash
# å…‹éš†ä»“åº“
cd /var/www
git clone https://github.com/ä½ çš„ç”¨æˆ·å/bondee.git bondee
cd bondee

# å®‰è£…ä¾èµ–å’Œæ„å»º
pnpm install
pnpm run build

# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la dist/
```

### æ­¥éª¤ 5.2ï¼šæ¨é€ä»£ç è§¦å‘è‡ªåŠ¨éƒ¨ç½²

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
git add .
git commit -m "test: æµ‹è¯• CI/CD æµç¨‹"
git push origin main
```

**è§‚å¯Ÿéƒ¨ç½²è¿‡ç¨‹**ï¼š

1. æ‰“å¼€ GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. æŸ¥çœ‹æœ€æ–°çš„ workflow è¿è¡Œè®°å½•
4. ç‚¹å‡»è¿›å»å¯ä»¥çœ‹åˆ°è¯¦ç»†æ—¥å¿—

### æ­¥éª¤ 5.3ï¼šéªŒè¯éƒ¨ç½²ç»“æœ

```bash
# è®¿é—®ä½ çš„ç½‘ç«™
http://ä½ çš„æœåŠ¡å™¨IP
```

**æ£€æŸ¥æ¸…å•**ï¼š

- [ ] ç½‘ç«™èƒ½æ­£å¸¸è®¿é—®
- [ ] é¡µé¢å†…å®¹æ­£ç¡®æ˜¾ç¤º
- [ ] è·¯ç”±è·³è½¬æ­£å¸¸ï¼ˆReact Routerï¼‰
- [ ] é™æ€èµ„æºåŠ è½½æˆåŠŸï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰

### æ­¥éª¤ 5.4ï¼šæŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

```bash
# SSH åˆ°æœåŠ¡å™¨

# æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æŸ¥çœ‹éƒ¨ç½²çš„æ–‡ä»¶
ls -la /var/www/bondee/dist/
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šGitHub Actions è¿æ¥æœåŠ¡å™¨å¤±è´¥

**ç—‡çŠ¶**ï¼š

```
Permission denied (publickey)
```

**æ’æŸ¥æ­¥éª¤**ï¼š

1. æ£€æŸ¥ SSH ç§é’¥æ˜¯å¦æ­£ç¡®

   ```bash
   # åœ¨æœ¬åœ°æŸ¥çœ‹ç§é’¥
   cat ~/.ssh/id_rsa
   ```

   å¤åˆ¶å®Œæ•´å†…å®¹åˆ° GitHub Secrets çš„ `SERVER_SSH_KEY`

2. æ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„å…¬é’¥

   ```bash
   cat ~/.ssh/authorized_keys
   ```

   åº”è¯¥åŒ…å«å¯¹åº”çš„å…¬é’¥

3. æ£€æŸ¥ SSH æœåŠ¡

   ```bash
   sudo systemctl status ssh
   ```

4. æ£€æŸ¥é˜²ç«å¢™
   ```bash
   sudo ufw status
   # ç¡®ä¿ 22 ç«¯å£å·²å¼€æ”¾
   ```

### é—®é¢˜ 2ï¼šç½‘ç«™æ˜¾ç¤º 404 Not Found

**å¯èƒ½åŸå› **ï¼š

1. **Nginx é…ç½®é”™è¯¯**

   ```bash
   # æ£€æŸ¥é…ç½®
   sudo nginx -t

   # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
   sudo tail -f /var/log/nginx/error.log
   ```

2. **æ„å»ºäº§ç‰©è·¯å¾„ä¸å¯¹**

   ```bash
   # æ£€æŸ¥ dist ç›®å½•æ˜¯å¦å­˜åœ¨
   ls -la /var/www/bondee/dist/

   # æ£€æŸ¥ index.html æ˜¯å¦å­˜åœ¨
   ls -la /var/www/bondee/dist/index.html
   ```

3. **Nginx é…ç½®ç›®å½•æƒé™**
   ```bash
   sudo chown -R www-data:www-data /var/www/bondee/dist
   sudo chmod -R 755 /var/www/bondee/dist
   ```

### é—®é¢˜ 3ï¼šå‰ç«¯è·¯ç”±åˆ·æ–°å 404

**åŸå› **ï¼šNginx æ²¡æœ‰é…ç½® SPA è·¯ç”±æ”¯æŒ

**è§£å†³**ï¼šç¡®ä¿ Nginx é…ç½®ä¸­æœ‰ä»¥ä¸‹ä»£ç ï¼š

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

### é—®é¢˜ 4ï¼šæ„å»ºå¤±è´¥ - å†…å­˜ä¸è¶³

**ç—‡çŠ¶**ï¼š

```
FATAL ERROR: Ineffective mark-compacts near heap limit
```

**åŸå› **ï¼š2 æ ¸ 2G æœåŠ¡å™¨å†…å­˜å¯èƒ½ä¸å¤Ÿæ„å»º

**è§£å†³æ–¹æ¡ˆ 1**ï¼šåœ¨ GitHub ä¸Šæ„å»ºï¼ˆæ¨èï¼‰

- ä½¿ç”¨å®Œæ•´ç‰ˆ workflowï¼Œæ„å»ºåœ¨ GitHub Runner ä¸Šè¿›è¡Œ
- åªä¼ è¾“æ„å»ºç»“æœåˆ°æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ 2**ï¼šå¢åŠ  swap ç©ºé—´

```bash
# åˆ›å»º 2G swap
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æŒä¹…åŒ–
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

**è§£å†³æ–¹æ¡ˆ 3**ï¼šé™åˆ¶ Node.js å†…å­˜

```bash
# åœ¨éƒ¨ç½²è„šæœ¬ä¸­æ·»åŠ 
export NODE_OPTIONS="--max-old-space-size=1536"
pnpm run build
```

### é—®é¢˜ 5ï¼šæ¨é€ä»£ç åæ²¡æœ‰è§¦å‘ Actions

**æ£€æŸ¥**ï¼š

1. ç¡®è®¤æ¨é€åˆ°äº†æ­£ç¡®çš„åˆ†æ”¯ï¼ˆmainï¼‰

   ```bash
   git branch --show-current
   ```

2. æ£€æŸ¥ workflow æ–‡ä»¶ä½ç½®

   - å¿…é¡»åœ¨ `.github/workflows/` ç›®å½•ä¸‹
   - æ–‡ä»¶æ‰©å±•åæ˜¯ `.yml` æˆ– `.yaml`

3. æ£€æŸ¥ YAML è¯­æ³•

   - åœ¨ GitHub ä»“åº“çš„ Actions é¡µé¢æŸ¥çœ‹æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

4. æ£€æŸ¥ Actions æ˜¯å¦å¯ç”¨
   - Settings â†’ Actions â†’ General â†’ Allow all actions

### é—®é¢˜ 6ï¼šéƒ¨ç½²æˆåŠŸä½†çœ‹åˆ°çš„æ˜¯æ—§ç‰ˆæœ¬

**åŸå› **ï¼šæµè§ˆå™¨ç¼“å­˜

**è§£å†³**ï¼š

1. å¼ºåˆ¶åˆ·æ–°ï¼š`Ctrl + Shift + R` (Windows) æˆ– `Cmd + Shift + R` (Mac)

2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

3. æˆ–åœ¨ Nginx é…ç½®ä¸­è°ƒæ•´ç¼“å­˜ç­–ç•¥ï¼š
   ```nginx
   # index.html ä¸ç¼“å­˜
   location = /index.html {
       add_header Cache-Control "no-cache, no-store, must-revalidate";
   }
   ```

---

## ğŸ“ å­¦ä¹ æ€»ç»“

é€šè¿‡è¿™ä¸ª CI/CD æµç¨‹ï¼Œä½ å­¦åˆ°äº†ï¼š

### 1. **CI/CD æ ¸å¿ƒæ¦‚å¿µ**

- âœ… è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²
- âœ… ä»£ç æ¨é€å³éƒ¨ç½²
- âœ… å¿«é€Ÿåé¦ˆå’Œè¿­ä»£

### 2. **Linux æœåŠ¡å™¨ç®¡ç†**

- âœ… SSH è¿œç¨‹è¿æ¥
- âœ… åŒ…ç®¡ç†ï¼ˆaptï¼‰
- âœ… æœåŠ¡ç®¡ç†ï¼ˆsystemctlï¼‰
- âœ… æ–‡ä»¶æƒé™ç®¡ç†ï¼ˆchmod, chownï¼‰
- âœ… é˜²ç«å¢™é…ç½®ï¼ˆufwï¼‰

### 3. **Web æœåŠ¡å™¨é…ç½®**

- âœ… Nginx å®‰è£…å’Œé…ç½®
- âœ… è™šæ‹Ÿä¸»æœºé…ç½®
- âœ… é™æ€æ–‡ä»¶æ‰˜ç®¡
- âœ… SPA è·¯ç”±æ”¯æŒ
- âœ… Gzip å‹ç¼©å’Œç¼“å­˜ç­–ç•¥

### 4. **GitHub Actions**

- âœ… Workflow è¯­æ³•
- âœ… è§¦å‘æ¡ä»¶é…ç½®
- âœ… ä½¿ç”¨ç¤¾åŒº Actions
- âœ… Secrets ç®¡ç†
- âœ… SSH è¿œç¨‹æ‰§è¡Œ

### 5. **Shell è„šæœ¬**

- âœ… Bash è„šæœ¬ç¼–å†™
- âœ… é”™è¯¯å¤„ç†ï¼ˆset -eï¼‰
- âœ… å¤‡ä»½ç­–ç•¥
- âœ… è‡ªåŠ¨åŒ–æµç¨‹

### 6. **Git å·¥ä½œæµ**

- âœ… åˆ†æ”¯ç®¡ç†
- âœ… è¿œç¨‹ä»“åº“æ“ä½œ
- âœ… ä»£ç å›æ»š

---

## ğŸ“š è¿›é˜¶ä¼˜åŒ–å»ºè®®

å®ŒæˆåŸºç¡€æµç¨‹åï¼Œå¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼š

### 1. ç¯å¢ƒåˆ†ç¦»

- é…ç½® `dev`ã€`staging`ã€`production` ä¸‰ä¸ªç¯å¢ƒ
- ä¸åŒåˆ†æ”¯éƒ¨ç½²åˆ°ä¸åŒæœåŠ¡å™¨

### 2. è‡ªåŠ¨åŒ–æµ‹è¯•

```yaml
- name: è¿è¡Œå•å…ƒæµ‹è¯•
  run: pnpm test

- name: è¿è¡Œ E2E æµ‹è¯•
  run: pnpm test:e2e
```

### 3. éƒ¨ç½²é€šçŸ¥

- é›†æˆé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€Slack é€šçŸ¥
- éƒ¨ç½²æˆåŠŸ/å¤±è´¥è‡ªåŠ¨æ¨é€æ¶ˆæ¯

### 4. å›æ»šæœºåˆ¶

- ä¿ç•™å¤šä¸ªç‰ˆæœ¬å¤‡ä»½
- ä¸€é”®å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬

### 5. HTTPS é…ç½®

- ä½¿ç”¨ Let's Encrypt å…è´¹ SSL è¯ä¹¦
- é…ç½® HTTPS è®¿é—®

### 6. CDN åŠ é€Ÿ

- å°†é™æ€èµ„æºä¸Šä¼ åˆ° OSS
- é…ç½® CDN åŠ é€Ÿè®¿é—®

### 7. ç›‘æ§å‘Šè­¦

- é…ç½®æœåŠ¡å™¨ç›‘æ§ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- ç½‘ç«™å¯ç”¨æ€§ç›‘æ§

### 8. æ€§èƒ½ä¼˜åŒ–

- ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰
- æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰
- èµ„æºé¢„åŠ è½½
- å›¾ç‰‡ä¼˜åŒ–

---

## ğŸ”— å‚è€ƒèµ„æ–™

- [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions)
- [Nginx å®˜æ–¹æ–‡æ¡£](https://nginx.org/en/docs/)
- [PM2 è¿›ç¨‹ç®¡ç†å™¨](https://pm2.keymetrics.io/)
- [Let's Encrypt](https://letsencrypt.org/)
- [é˜¿é‡Œäº‘ OSS](https://help.aliyun.com/product/31815.html)

---

## ğŸ“ å°è´´å£«

- æ¯æ¬¡éƒ¨ç½²å‰å…ˆåœ¨æœ¬åœ°æµ‹è¯•æ„å»ºæ˜¯å¦æˆåŠŸ
- é‡è¦é…ç½®æ–‡ä»¶è¦åšå¥½å¤‡ä»½
- å®šæœŸæ¸…ç†æœåŠ¡å™¨æ—¥å¿—å’Œå¤‡ä»½æ–‡ä»¶
- å…³æ³¨ GitHub Actions çš„è¿è¡Œæ—¶é—´ï¼ˆå…è´¹ç‰ˆæœ‰é™é¢ï¼‰
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

---

**ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸ‰**

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶äº¤æµï¼
